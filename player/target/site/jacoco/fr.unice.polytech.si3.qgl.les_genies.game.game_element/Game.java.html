<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Game.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">les_genies</a> &gt; <a href="index.source.html" class="el_package">fr.unice.polytech.si3.qgl.les_genies.game.game_element</a> &gt; <span class="el_source">Game.java</span></div><h1>Game.java</h1><pre class="source lang-java linenums">package fr.unice.polytech.si3.qgl.les_genies.game.game_element;

import fr.unice.polytech.si3.qgl.les_genies.game.checkpoint.Checkpoint;
import fr.unice.polytech.si3.qgl.les_genies.game.checkpoint.RegattaGoal;
import fr.unice.polytech.si3.qgl.les_genies.game.map.MapGrid;
import fr.unice.polytech.si3.qgl.les_genies.game.ship.Ship;
import fr.unice.polytech.si3.qgl.les_genies.game.tools.Position;
import fr.unice.polytech.si3.qgl.les_genies.game.visible_entities.VisibleEntities;
import fr.unice.polytech.si3.qgl.les_genies.game.actions.Action;
import fr.unice.polytech.si3.qgl.les_genies.game.crew.Captain;
import fr.unice.polytech.si3.qgl.les_genies.game.crew.Sailor;
import fr.unice.polytech.si3.qgl.les_genies.game.visible_entities.Wind;
import java.util.Arrays;
import java.util.List;

public class Game {

    private RegattaGoal goal;
    private final Ship ship;
    private Sailor[] sailors;
    private int shipCount;
    private List&lt;VisibleEntities&gt; visibleEntities;
    private final Captain captain;
    private Wind wind;
    private MapGrid map;
<span class="fc" id="L26">    private int distanceX = 0;</span>
<span class="fc" id="L27">    private int distanceY = 0;</span>
    private final boolean isPositive;

<span class="fc" id="L30">    public Game(InitGame init, boolean setPositive){</span>
<span class="fc" id="L31">        this.goal = init.getGoal();</span>
<span class="fc" id="L32">        this.ship = init.getShip();</span>
<span class="fc" id="L33">        this.sailors = init.getSailors();</span>
<span class="fc" id="L34">        this.shipCount = init.getShipCount();</span>
<span class="fc" id="L35">        this.captain = new Captain(this);</span>
<span class="fc" id="L36">        this.wind = null;</span>
<span class="fc" id="L37">        this.isPositive = setPositive;</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">        if(ship!=null){</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">            if(this.isPositive)replaceEntitiesOnPositiveCoordinates();</span>
<span class="fc" id="L40">            this.map = new MapGrid(70, goal.getCheckpoints());</span>
        }
<span class="fc" id="L42">    }</span>

    private void replaceEntitiesOnPositiveCoordinates() {
<span class="fc" id="L45">        getMinCoordinates(ship.getPosition());</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">        for(Checkpoint c:goal.getCheckpoints()) getMinCoordinates(c.getPosition());</span>
<span class="fc bfc" id="L47" title="All 2 branches covered.">        for(Checkpoint c:goal.getCheckpoints()) addDistance(c.getPosition());</span>

<span class="fc" id="L49">        actualiseShipPosition();</span>
<span class="fc" id="L50">    }</span>

    private void getMinCoordinates(Position position) {

<span class="fc bfc" id="L54" title="All 2 branches covered.">        if (position.getX() &lt; distanceX) distanceX = (int) position.getX();</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (position.getY() &lt; distanceY) distanceY = (int) position.getY();</span>
<span class="fc" id="L56">    }</span>

    private void actualiseShipPosition(){
<span class="fc" id="L59">        addDistance(ship.getPosition());</span>
<span class="fc" id="L60">    }</span>

    private void actualiseEntitiesPositions(){
<span class="fc bfc" id="L63" title="All 2 branches covered.">        for(VisibleEntities v : visibleEntities) addDistance(v.getPosition());</span>
<span class="fc" id="L64">    }</span>

    public void addDistance(Position p) {
<span class="fc" id="L67">        p.setX(p.getX()-distanceX+1000);</span>
<span class="fc" id="L68">        p.setY(p.getY()-distanceY+5000);</span>
<span class="fc" id="L69">    }</span>

    public Ship getShip(){
<span class="fc" id="L72">        return this.ship;</span>
    }
    public List&lt;VisibleEntities&gt; getVisibleEntities(){
<span class="fc" id="L75">        return this.visibleEntities;</span>
    }
    /**
     * @param goal define in Init
     */
    public void setGoal(RegattaGoal goal) {
<span class="nc" id="L81">        this.goal = goal;</span>
<span class="nc" id="L82">    }</span>

    /**
     * @param sailors define in Init or NextRound
     */
    public void setSailors(Sailor[] sailors) {
<span class="nc" id="L88">        this.sailors = sailors;</span>
<span class="nc" id="L89">    }</span>

    /**
     * @param shipCount define in init
     */
    public void setShipCount(int shipCount) {
<span class="nc" id="L95">        this.shipCount = shipCount;</span>
<span class="nc" id="L96">    }</span>

    public Wind getWind() {
<span class="nc" id="L99">        return wind;</span>
    }

    public void setWind(Wind wind) {
<span class="nc" id="L103">        this.wind = wind;</span>
<span class="nc" id="L104">    }</span>

    public void setVisibleEntities(List&lt;VisibleEntities&gt; visibleEntities) {
<span class="fc" id="L107">        this.visibleEntities = visibleEntities;</span>
<span class="fc" id="L108">    }</span>

    /**
     * update Game with new information get from NextRound
     *
     * @param next Object json create by the read of game state
     */
    public void updateGame(NextRound next){
<span class="fc" id="L116">        this.ship.updateShip(next.getShip());</span>
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">        if(isPositive)addDistance(ship.getPosition());</span>
<span class="fc" id="L118">        this.wind = next.getWind();</span>
<span class="fc" id="L119">        setVisibleEntities(next.getVisibleEntities());</span>
<span class="fc" id="L120">        actualiseEntitiesPositions();</span>
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">        if (map.update(visibleEntities))</span>
<span class="fc" id="L122">            goal.generatePathList(map, ship.getPosition());</span>
<span class="fc" id="L123">    }</span>

    public Sailor[] getSailors() {
<span class="fc" id="L126">        return sailors;</span>
    }

    public RegattaGoal getGoal() {
<span class="fc" id="L130">        return goal;</span>
    }

    /**
     * @return String of all actions
     */
    public String nextRound() {
<span class="nc" id="L137">        captain.resetOrder();</span>
<span class="nc" id="L138">        captain.execution();</span>
<span class="nc" id="L139">        StringBuilder actionsStr = new StringBuilder();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        for (Action action : captain.getOrdersAction()) {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">            if (actionsStr.length() == 0) actionsStr.append(action.toString());</span>
<span class="nc" id="L142">            else actionsStr.append(&quot;,&quot;).append(action.toString());</span>
<span class="nc" id="L143">        }</span>
<span class="nc" id="L144">        return &quot;[&quot; + actionsStr + &quot;]&quot;;</span>
    }

    public Position getCurrentCheckpointPosition(){
<span class="nc" id="L148">        return goal.getCurrentCheckpoint().getPosition();</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L153">        return &quot;Game{&quot; +</span>
                &quot;goal=&quot; + goal +
                &quot;, ship=&quot; + ship +
<span class="fc" id="L156">                &quot;, sailors=&quot; + Arrays.toString(sailors) +</span>
                &quot;, shipCount=&quot; + shipCount +
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">                &quot;, visibleEntities=&quot; + (visibleEntities==null?null:Arrays.toString(visibleEntities.toArray())) +</span>
                &quot;, wind=&quot; + wind +
                '}';
    }

    public MapGrid getMap() {
<span class="nc" id="L164">        return map;</span>
    }

    public int getDistanceX() {
<span class="nc" id="L168">        return distanceX;</span>
    }

    public int getDistanceY() {
<span class="nc" id="L172">        return distanceY;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>